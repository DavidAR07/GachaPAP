<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fantasy Praktikum Gacha</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Cinzel', 'Trajan Pro', 'Georgia', serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1410 25%, #0f0f0f 50%, #1a1410 75%, #000000 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        repeating-linear-gradient(90deg, rgba(198, 151, 45, 0.02) 0px, transparent 2px, transparent 4px, rgba(198, 151, 45, 0.02) 6px),
        repeating-linear-gradient(0deg, rgba(198, 151, 45, 0.02) 0px, transparent 2px, transparent 4px, rgba(198, 151, 45, 0.02) 6px),
        radial-gradient(circle at 30% 40%, rgba(198, 151, 45, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 70% 60%, rgba(192, 192, 192, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 50% 80%, rgba(139, 0, 0, 0.03) 0%, transparent 50%);
      pointer-events: none;
    }

    .container {
      width: 90%;
      max-width: 850px;
      padding: 40px;
      text-align: center;
    }

    .title {
      font-size: 52px;
      font-weight: bold;
      color: #c6972d;
      text-shadow: 0 3px 6px rgba(0, 0, 0, 0.9), 0 0 30px rgba(198, 151, 45, 0.6);
      margin-bottom: 15px;
      letter-spacing: 4px;
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 22px;
      color: #c0c0c0;
      font-style: italic;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
      letter-spacing: 2px;
      margin-bottom: 40px;
    }

    .save-button {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.2));
      color: #4ade80;
      border: 2px solid rgba(34, 197, 94, 0.5);
      padding: 14px 35px;
      font-size: 17px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
      margin-left: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .save-button:hover {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.5), rgba(22, 163, 74, 0.4));
      border-color: #22c55e;
      color: #ffffff;
      box-shadow: 0 4px 20px rgba(34, 197, 94, 0.6),
                  0 0 25px rgba(34, 197, 94, 0.4);
      transform: translateY(-2px);
    }

    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.95));
      color: #ffffff;
      padding: 16px 32px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.8), 0 0 40px rgba(34, 197, 94, 0.6);
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
    }

    .gacha-button, .reset-button {
      margin: 10px;
    }

    .gacha-button {
      background: linear-gradient(135deg, #c6972d, #ffd700, #c0c0c0);
      color: #000;
      border: 3px solid #c6972d;
      padding: 20px 60px;
      font-size: 24px;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.4s ease;
    }

    .reset-button {
      background: rgba(198, 151, 45, 0.15);
      color: #c0c0c0;
      border: 2px solid rgba(192, 192, 192, 0.3);
      padding: 14px 35px;
      font-size: 17px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .group-btn {
      background: linear-gradient(135deg, rgba(198, 151, 45, 0.2), rgba(20, 20, 20, 0.6));
      border: 2px solid rgba(192, 192, 192, 0.3);
      color: #c0c0c0;
      padding: 14px;
      font-size: 17px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .group-btn.selected {
      background: linear-gradient(135deg, #c6972d, #ffd700, #c0c0c0);
      color: #000;
      transform: scale(1.05);
    }

    .group-item {
      background: linear-gradient(135deg, rgba(20, 20, 20, 0.8), rgba(10, 10, 10, 0.7));
      border-left: 5px solid rgba(198, 151, 45, 0.5);
      padding: 18px;
      margin: 12px 0;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 15px;
      transition: all 0.3s ease;
    }

    .group-item.assigned {
      border-left-color: #c6972d;
      box-shadow: 0 0 15px rgba(198, 151, 45, 0.5);
      background: linear-gradient(135deg, rgba(198, 151, 45, 0.2), rgba(10, 10, 10, 0.8));
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">üè∞ Royal Praktikum Quest üè∞</h1>
    <p class="subtitle">Kastil kerajaan menentukan misi praktikummu...</p>

    <div id="groupSelector">
      <p style="color: #c0c0c0; font-size: 19px;">Pilih Kelompok:</p>
      <div id="groupButtons" class="grid grid-cols-5 gap-3 justify-center"></div>
    </div>

    <div id="resultDisplay" style="display: none; margin-top: 20px;">
      <p style="color: #c6972d;">Klik tombol untuk mengundi judul praktikum</p>
    </div>

    <button class="gacha-button" id="gachaButton" onclick="performGacha()" style="display:none;">‚öîÔ∏è Mulai Quest ‚öîÔ∏è</button>
    <button class="reset-button" id="resetButton" onclick="resetGacha()" style="display:none;">üîÑ Reset Quest</button>

    <div class="groups-list" style="margin-top: 40px;">
      <h2 style="color: #c6972d; text-transform: uppercase;">‚öîÔ∏è Royal Guild Roster ‚öîÔ∏è</h2>
      <div id="groupsList"></div>
    </div>

    <!-- ‚úÖ Section Save -->
    <div id="saveSection" style="display:none; text-align:center;">
      <button class="save-button" onclick="saveToExcel()">üíæ Simpan Hasil Gacha</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const praktikumTitles = [
      "Desain dan Rancang Tangga Nada Berbasis Filter Band Pass",
      "Karakteristik Photodioda",
      "Water level detector using lm741",
      "LED Chaser (BC547 Transistor LED Flasher)",
      "Metal detector using bc547",
      "Obstacle Detector",
      "Fire Detector Alarm using BC547",
      "Logic Gate Circuit with 1N4148-BC547",
      "Rangkaian pengusir nyamuk",
      "Inverter DC to AC (Square Wave)",
      "Sistem Keamanan Laser",
      "Sound-Triggered LED Circuit",
      "Otomatic Solar Tracker",
      "Flip-Flop 3 LED",
      "Rain Level Detector",
      "Metal Detector",
      "Lampu Darurat Otomatis",
      "Radio AM Sederhana",
      "Shadow Sensor Alarm Using LM 741",
      "Topeng Ilusi: Virtual Reality System"
    ];

    let availableTitles = [...praktikumTitles];
    let assignments = {};
    let selectedGroup = null;

    function renderGroupButtons() {
      const container = document.getElementById('groupButtons');
      container.innerHTML = '';
      for (let i = 1; i <= 20; i++) {
        const btn = document.createElement('button');
        btn.className = 'group-btn';
        btn.textContent = i;
        btn.disabled = assignments[i];
        btn.onclick = () => selectGroup(i);
        container.appendChild(btn);
      }
    }

    function selectGroup(groupNumber) {
      selectedGroup = groupNumber;
      document.getElementById('resultDisplay').style.display = 'block';
      document.getElementById('gachaButton').style.display = 'inline-block';
    }

    function performGacha() {
      if (!selectedGroup || availableTitles.length === 0) return;
      const randomIndex = Math.floor(Math.random() * availableTitles.length);
      const selectedTitle = availableTitles.splice(randomIndex, 1)[0];
      assignments[selectedGroup] = selectedTitle;
      renderGroupsList();
      renderGroupButtons();
      document.getElementById('saveSection').style.display = 'block';
      selectedGroup = null;
      document.getElementById('resultDisplay').style.display = 'none';
      document.getElementById('gachaButton').style.display = 'none';
    }

    function renderGroupsList() {
      const list = document.getElementById('groupsList');
      list.innerHTML = '';
      for (let i = 1; i <= 20; i++) {
        const div = document.createElement('div');
        div.className = 'group-item' + (assignments[i] ? ' assigned' : '');
        div.innerHTML = `
          <span style="color:#c0c0c0;font-weight:bold;">Kelompok ${i}</span>
          <span style="color:#c6972d;">${assignments[i] || '‚Äî'}</span>
        `;
        list.appendChild(div);
      }
    }

    function resetGacha() {
      availableTitles = [...praktikumTitles];
      assignments = {};
      renderGroupsList();
      renderGroupButtons();
      document.getElementById('saveSection').style.display = 'none';
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function saveToExcel() {
      if (Object.keys(assignments).length === 0) {
        showToast('‚ö†Ô∏è Belum ada hasil gacha untuk disimpan!');
        return;
      }
      let csv = '\uFEFFKelompok,Judul Praktikum\n';
      for (let i = 1; i <= 20; i++) {
        if (assignments[i]) csv += `Kelompok ${i},"${assignments[i]}"\n`;
      }
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
      link.href = url;
      link.download = `Hasil_Gacha_Praktikum_${timestamp}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showToast('‚úÖ File Excel berhasil didownload!');
    }

    renderGroupButtons();
    renderGroupsList();
  </script>
</body>
</html>
